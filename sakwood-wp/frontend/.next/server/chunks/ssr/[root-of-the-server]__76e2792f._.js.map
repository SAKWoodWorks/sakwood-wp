{"version":3,"sources":["../../../../../../sakwood-wp/frontend/components/search/SearchResults.tsx/__nextjs-internal-proxy.mjs","../../../../../../sakwood-wp/frontend/app/%5Blang%5D/search/page.tsx","../../../../../../sakwood-wp/frontend/lib/services/searchService.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SearchResults = registerClientReference(\n    function() { throw new Error(\"Attempted to call SearchResults() from the server but SearchResults is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/sakwood-wp/frontend/components/search/SearchResults.tsx\",\n    \"SearchResults\",\n);\n","import { redirect } from 'next/navigation';\nimport { getDictionary } from '@/lib/get-dictionary';\nimport { searchProducts } from '@/lib/services/searchService';\nimport type { Metadata } from 'next';\nimport type { Locale } from '@/i18n-config';\nimport { SearchResults } from '@/components/search/SearchResults';\n\ninterface SearchPageProps {\n  params: Promise<{\n    lang: string;\n  }>;\n  searchParams: Promise<{\n    q?: string;\n  }>;\n}\n\nexport async function generateMetadata({ params }: SearchPageProps): Promise<Metadata> {\n  const { lang } = await params;\n  const isThai = lang === 'th';\n\n  return {\n    title: isThai ? 'ค้นหาสินค้า | Sakwood' : 'Search Products | Sakwood',\n    description: isThai\n      ? 'ค้นหาสินค้าไม้คุณภาพจาก Sakwood'\n      : 'Search for premium wood products from Sakwood',\n  };\n}\n\nexport default async function SearchPage({ params, searchParams }: SearchPageProps) {\n  const { lang } = await params;\n  const { q: searchQuery } = await searchParams;\n\n  // Redirect if no search query\n  if (!searchQuery) {\n    redirect(`/${lang}`);\n  }\n\n  const dictionary = await getDictionary(lang as Locale);\n\n  // Search for products\n  const searchResults = await searchProducts(searchQuery, lang);\n\n  return (\n    <SearchResults\n      lang={lang as Locale}\n      dictionary={dictionary}\n      searchQuery={searchQuery}\n      initialResults={searchResults}\n    />\n  );\n}\n","import { API_CONFIG } from '@/lib/config/constants';\n\ninterface SearchProduct {\n  id: string;\n  name: string;\n  slug: string;\n  price?: string;\n  regularPrice?: string;\n  description?: string;\n  image?: {\n    sourceUrl: string;\n    altText?: string;\n  };\n  shortDescription?: string;\n  type?: string;\n}\n\ninterface SearchResponse {\n  products: SearchProduct[];\n  total: number;\n}\n\n/**\n * Search products using WordPress GraphQL API\n */\nexport async function searchProducts(\n  query: string,\n  lang: string = 'th'\n): Promise<SearchResponse> {\n  if (!query || query.trim().length === 0) {\n    return { products: [], total: 0 };\n  }\n\n  try {\n    let searchTerm = query.trim();\n\n    // Remove spaces for Thai searches to improve matching\n    // Thai product names often don't need spaces between characters\n    if (lang === 'th') {\n      searchTerm = searchTerm.replace(/\\s+/g, '');\n    }\n\n    // GraphQL query to search products by name, description, or short description\n    const graphqlQuery = `\n      query SearchProducts($search: String!) {\n        products(where: { search: $search }) {\n          nodes {\n            id: databaseId\n            slug\n            name\n            type\n            description\n            shortDescription(format: RENDERED)\n            ... on SimpleProduct {\n              price\n              regularPrice\n            }\n            ... on VariableProduct {\n              price\n              regularPrice\n            }\n            image {\n              sourceUrl\n              altText\n            }\n          }\n        }\n      }\n    `;\n\n    const response = await fetch(API_CONFIG.endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        query: graphqlQuery,\n        variables: {\n          search: searchTerm,\n        },\n      }),\n      next: { revalidate: 30 }, // Cache for 30 seconds\n    });\n\n    if (!response.ok) {\n      console.error('[SearchService] Failed to fetch:', response.statusText);\n      return { products: [], total: 0 };\n    }\n\n    const data = await response.json();\n    const products = data.data?.products?.nodes || [];\n\n    // Transform data to match our Product type\n    const transformedProducts: SearchProduct[] = products.map((product: any) => ({\n      id: String(product.id),\n      name: product.name,\n      slug: product.slug,\n      price: product.price || undefined,\n      regularPrice: product.regularPrice || undefined,\n      description: product.description || undefined,\n      image: product.image || undefined,\n      shortDescription: product.shortDescription || undefined,\n      type: product.type || 'simple',\n    }));\n\n    return {\n      products: transformedProducts,\n      total: transformedProducts.length,\n    };\n  } catch (error) {\n    console.error('[SearchService] Error searching products:', error);\n    return { products: [], total: 0 };\n  }\n}\n"],"names":[],"mappings":"gbAEO,IAAM,EAAgB,CAAA,EAAA,AAD7B,EAAA,CAAA,CAAA,OAC6B,uBAAA,AAAuB,EAChD,WAAa,MAAM,AAAI,MAAM,wOAA0O,EACvQ,wFACA,sEAHG,IAAM,EAAgB,CAAA,EAD7B,AAC6B,EAD7B,CAAA,CAAA,OAC6B,uBAAA,AAAuB,EAChD,WAAa,MAAM,AAAI,MAAM,wOAA0O,EACvQ,oEACA,oHCLJ,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCDA,EAAA,EAAA,CAAA,CAAA,OAyBO,eAAe,EACpB,CAAa,CACb,EAAe,IAAI,EAEnB,GAAI,CAAC,GAAS,AAAwB,GAAG,GAArB,IAAI,GAAG,MAAM,CAC/B,MAAO,CAAE,SAAU,EAAE,CAAE,MAAO,CAAE,EAGlC,GAAI,CACF,IAAI,EAAa,EAAM,IAAI,GAId,MAAM,CAAf,IACF,EAAa,EAAW,OAAO,CAAC,OAAQ,GAAA,EAI1C,IAAM,EAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;IAyBtB,CAAC,CAEK,EAAW,MAAM,MAAM,EAAA,UAAU,CAAC,QAAQ,CAAE,CAChD,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,CACnB,MAAO,EACP,UAAW,CACT,OAAQ,CACV,CACF,GACA,KAAM,CAAE,WAAY,EAAG,CACzB,GAEA,GAAI,CAAC,EAAS,EAAE,CAEd,CAFgB,MAChB,QAAQ,KAAK,CAAC,mCAAoC,EAAS,UAAU,EAC9D,CAAE,SAAU,EAAE,CAAE,MAAO,CAAE,EAGlC,IAAM,EAAO,MAAM,EAAS,IAAI,GAI1B,EAAuC,CAH5B,EAAK,IAAI,EAAE,UAAU,OAAS,EAAA,AAAE,EAGK,GAAG,CAAE,AAAD,IAAmB,CAC3E,GAAI,EADsE,KAC/D,EAAQ,EAAE,EACrB,KAAM,EAAQ,IAAI,CAClB,KAAM,EAAQ,IAAI,CAClB,MAAO,EAAQ,KAAK,OAAI,EACxB,aAAc,EAAQ,YAAY,OAAI,EACtC,YAAa,EAAQ,WAAW,OAAI,EACpC,MAAO,EAAQ,KAAK,EAAI,OACxB,iBAAkB,EAAQ,gBAAgB,OAAI,EAC9C,KAAM,EAAQ,IAAI,EAAI,SACxB,CAAC,EAED,MAAO,CACL,SAAU,EACV,MAAO,EAAoB,MAAM,AACnC,CACF,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,4CAA6C,GACpD,CAAE,SAAU,EAAE,CAAE,MAAO,CAAE,CAClC,CACF,CD5GA,IAAA,EAAA,EAAA,CAAA,CAAA,OAWO,eAAe,EAAiB,QAAE,CAAM,CAAmB,EAChE,GAAM,CAAE,MAAI,CAAE,CAAG,MAAM,EACjB,EAAkB,OAAT,EAEf,MAAO,CACL,MAAO,EAAS,wBAA0B,4BAC1C,YAAa,EACT,kCACA,+CACN,CACF,CAEe,eAAe,EAAW,QAAE,CAAM,CAAE,cAAY,CAAmB,EAChF,GAAM,MAAE,CAAI,CAAE,CAAG,MAAM,EACjB,CAAE,EAAG,CAAW,CAAE,CAAG,MAAM,CAG7B,CAAC,GACH,CAAA,EAAA,EAAA,KADgB,GAChB,AAAQ,EAAC,CAAC,CAAC,EAAE,EAAA,CAAM,EAGrB,IAAM,EAAa,MAAM,CAAA,EAAA,EAAA,aAAA,AAAa,EAAC,GAGjC,EAAgB,MAAM,EAAe,EAAa,GAExD,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CACZ,KAAM,EACN,WAAY,EACZ,YAAa,EACb,eAAgB,GAGtB","ignoreList":[0]}